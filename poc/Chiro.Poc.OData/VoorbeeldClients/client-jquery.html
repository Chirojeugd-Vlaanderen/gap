<!DOCTYPE html>
<!-- DISCLAIMER: ik heb weinig kaas gegeten van JQuery, ik doe altijd
     maar wat :-) -->
<html>
	<head>
		<title>API-test</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

		<script>
			// pas onderstaande aan
			var SERVICE_LOCATIE='lap-jve2.chiro.lokaal/ODataPoc/DataService.svc';

			// gebruikersnaam en wachtwoord voor de API
			// Het is uiteraard erg insecure om die gewoon in de javascript
			// te zetten, want door de source van de pagina te bekijken, heb
			// heb je de credentials vast.
			// Maar dit is gewoon ter illustratie

			var USER='apitest';	// laat leeg als geen authenticatie nodig is.
			var PASS='PubliekGeheim.';

			var SERVICE_URL;

			if (USER=='')
			{
				SERVICE_URL= "http://" + SERVICE_LOCATIE;
			}
			else
			{
				SERVICE_URL="http://" + USER + ":" + PASS + "@" + SERVICE_LOCATIE;
			}

			// pas onderstaande url aan!

			// In de implementatie van DataServicesJSONP heet de callback-parameter
			// '$callback' (en niet gewoon 'callback')

			$.ajaxSetup({jsonp: '$callback'});
		</script>

	</head>

	<body>

		<button id="knop">Klik me</button> <br />
		<div id="ledenlijst" />

		<script type="text/javascript">
			$("#knop").click(function() {

				// Blijkbaar is het onmogelijk om request headers aan
				// te passen als je JSONP gebruikt

				var myurl=SERVICE_URL+"/Leden?$format=json";

				$.ajax({
					dataType: 'jsonp',
  					url: myurl,
					username: 'apitest',
					password: 'PubliekGeheim.',
					success: function (data) {
						$("#ledenlijst").text('');
						$.each(
							data.d.results, 
							function(index, value){
								$("#ledenlijst").append(value.Naam + " van de " + value.Afdeling + " <br />" );
							});
  					},
				});
			});
		</script>

	</body>
</html>
		
